#!/usr/bin/env node

/**
 * Module dependencies.
 */

var server = require('../lib/server')
  , client = require('../lib/client')
  , program = require('commander')
  , pkg = require('../package');

// options

program
  .version(pkg.version)
  .option('-a, --addr <addr>', 'bind address [0.0.0.0]', '0.0.0.0')
  .option('-g, --get <cycle>', 'get data for <cycle>')
  .parse(process.argv);

// title

process.title = 'trace';

// --get <cycle>

if (program.get) {
  return client.get(program.get, function(err, data){
    if (err) throw err;
    process.stdout.write(JSON.stringify(data, null, 2), function(){
      process.exit(1);
    });
  });
}

// bind

var addr = 'tcp://' + program.addr + ':5555';
server.sub.bind(addr);
console.log('sub bound to %s', addr);

var addr = 'tcp://' + program.addr + ':5556';
server.rep.bind(addr);
console.log('rep bound to %s', addr);
